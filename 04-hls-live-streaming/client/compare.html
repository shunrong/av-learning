<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTTP-FLV vs HLS å¯¹æ¯”</title>
  <script src="https://cdn.jsdelivr.net/npm/flv.js@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 2em;
    }
    
    .warning {
      background: #feebc8;
      border-left: 4px solid #dd6b20;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 1000px) {
      .comparison-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .player-card {
      background: #f7fafc;
      border-radius: 10px;
      padding: 20px;
    }
    
    .player-card h2 {
      color: #2d3748;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: bold;
    }
    
    .badge.flv {
      background: #fbd38d;
      color: #7c2d12;
    }
    
    .badge.hls {
      background: #90cdf4;
      color: #1a365d;
    }
    
    .player-container {
      position: relative;
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    
    video {
      width: 100%;
      display: block;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 0.9em;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .btn-play {
      background: #48bb78;
      color: white;
    }
    
    .btn-play:hover {
      background: #38a169;
    }
    
    .btn-stop {
      background: #fc8181;
      color: white;
    }
    
    .btn-stop:hover {
      background: #f56565;
    }
    
    .metrics {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .metric-item {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border-left: 3px solid #667eea;
    }
    
    .metric-label {
      font-size: 0.85em;
      color: #718096;
      margin-bottom: 3px;
    }
    
    .metric-value {
      font-size: 1.3em;
      font-weight: bold;
      color: #2d3748;
    }
    
    .analysis {
      background: #f7fafc;
      border-radius: 10px;
      padding: 20px;
      margin-top: 30px;
    }
    
    .analysis h3 {
      color: #2d3748;
      margin-bottom: 15px;
    }
    
    .analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
    }
    
    .analysis-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
    }
    
    .analysis-card h4 {
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .winner {
      display: inline-block;
      background: #c6f6d5;
      color: #22543d;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 0.85em;
      font-weight: bold;
      margin-left: 5px;
    }
    
    .back-link {
      display: inline-block;
      color: #667eea;
      text-decoration: none;
      margin-bottom: 20px;
      font-weight: bold;
    }
    
    .back-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
    
    <h1>ğŸ“Š HTTP-FLV vs HLS å®æ—¶å¯¹æ¯”</h1>
    
    <div class="warning">
      âš ï¸ <strong>æ³¨æ„</strong>ï¼šæ­¤å¯¹æ¯”é¡µé¢éœ€è¦åŒæ—¶è¿è¡Œ 03 å’Œ 04 é¡¹ç›®çš„æœåŠ¡å™¨<br>
      â€¢ 03 é¡¹ç›®ï¼ˆHTTP-FLVï¼‰ï¼šhttp://localhost:3001<br>
      â€¢ 04 é¡¹ç›®ï¼ˆHLSï¼‰ï¼šhttp://localhost:3000<br>
      â€¢ æ¨æµåœ°å€ç›¸åŒï¼šrtmp://localhost:1935/live/stream
    </div>
    
    <div class="comparison-grid">
      <!-- HTTP-FLV æ’­æ”¾å™¨ -->
      <div class="player-card">
        <h2>
          HTTP-FLV
          <span class="badge flv">03 é¡¹ç›®</span>
        </h2>
        
        <div class="player-container">
          <video id="flv-video" controls muted></video>
        </div>
        
        <div class="controls">
          <button class="btn-play" onclick="playFLV()">â–¶ æ’­æ”¾</button>
          <button class="btn-stop" onclick="stopFLV()">â¹ åœæ­¢</button>
        </div>
        
        <div class="metrics">
          <div class="metric-item">
            <div class="metric-label">å»¶è¿Ÿ(ä¼°ç®—)</div>
            <div class="metric-value" id="flv-latency">-</div>
          </div>
          <div class="metric-item">
            <div class="metric-label">ç¼“å†²é•¿åº¦</div>
            <div class="metric-value" id="flv-buffer">-</div>
          </div>
          <div class="metric-item">
            <div class="metric-label">å¡é¡¿æ¬¡æ•°</div>
            <div class="metric-value" id="flv-stalls">0</div>
          </div>
          <div class="metric-item">
            <div class="metric-label">çŠ¶æ€</div>
            <div class="metric-value" id="flv-status">æœªæ’­æ”¾</div>
          </div>
        </div>
      </div>
      
      <!-- HLS æ’­æ”¾å™¨ -->
      <div class="player-card">
        <h2>
          HLS
          <span class="badge hls">04 é¡¹ç›®</span>
        </h2>
        
        <div class="player-container">
          <video id="hls-video" controls muted></video>
        </div>
        
        <div class="controls">
          <button class="btn-play" onclick="playHLS()">â–¶ æ’­æ”¾</button>
          <button class="btn-stop" onclick="stopHLS()">â¹ åœæ­¢</button>
        </div>
        
        <div class="metrics">
          <div class="metric-item">
            <div class="metric-label">å»¶è¿Ÿ(ä¼°ç®—)</div>
            <div class="metric-value" id="hls-latency">-</div>
          </div>
          <div class="metric-item">
            <div class="metric-label">ç¼“å†²é•¿åº¦</div>
            <div class="metric-value" id="hls-buffer">-</div>
          </div>
          <div class="metric-item">
            <div class="metric-label">å¡é¡¿æ¬¡æ•°</div>
            <div class="metric-value" id="hls-stalls">0</div>
          </div>
          <div class="metric-item">
            <div class="metric-label">çŠ¶æ€</div>
            <div class="metric-value" id="hls-status">æœªæ’­æ”¾</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- åˆ†ææ€»ç»“ -->
    <div class="analysis">
      <h3>ğŸ“ˆ å¯¹æ¯”åˆ†æ</h3>
      <div class="analysis-grid">
        <div class="analysis-card">
          <h4>å»¶è¿Ÿå¯¹æ¯”</h4>
          <p><strong>HTTP-FLV</strong>: é€šå¸¸ 3-5 ç§’ <span class="winner">âœ“ æ›´ä½</span></p>
          <p><strong>HLS</strong>: é€šå¸¸ 10-30 ç§’ï¼ˆæ ‡å‡†ï¼‰ï¼Œ3-8 ç§’ï¼ˆä¼˜åŒ–åï¼‰</p>
          <p style="margin-top:10px; color:#718096; font-size:0.9em;">
            FLV æ˜¯é•¿è¿æ¥ç›´æ¥è½¬å‘ï¼ŒHLS éœ€è¦åˆ‡ç‰‡å’Œç¼“å†²
          </p>
        </div>
        
        <div class="analysis-card">
          <h4>å…¼å®¹æ€§å¯¹æ¯”</h4>
          <p><strong>HTTP-FLV</strong>: éœ€è¦ flv.jsï¼ˆMSEï¼‰ï¼Œä¸æ”¯æŒ Safari</p>
          <p><strong>HLS</strong>: ç§»åŠ¨ç«¯åŸç”Ÿæ”¯æŒ <span class="winner">âœ“ æ›´å¥½</span></p>
          <p style="margin-top:10px; color:#718096; font-size:0.9em;">
            HLS æ˜¯ Apple æ¨å‡ºçš„æ ‡å‡†ï¼ŒiOS/Safari åŸç”Ÿæ”¯æŒ
          </p>
        </div>
        
        <div class="analysis-card">
          <h4>CDN å‹å¥½åº¦</h4>
          <p><strong>HTTP-FLV</strong>: é•¿è¿æ¥ï¼Œç¼“å­˜å‘½ä¸­ç‡ä½</p>
          <p><strong>HLS</strong>: åˆ‡ç‰‡å¯ç¼“å­˜ <span class="winner">âœ“ æ›´ä¼˜</span></p>
          <p style="margin-top:10px; color:#718096; font-size:0.9em;">
            HLS çš„ TS åˆ‡ç‰‡æ˜¯é™æ€æ–‡ä»¶ï¼ŒCDN å¯ä»¥é«˜æ•ˆç¼“å­˜
          </p>
        </div>
        
        <div class="analysis-card">
          <h4>é€‚ç”¨åœºæ™¯</h4>
          <p><strong>HTTP-FLV</strong>: PC ç›´æ’­ã€ä½å»¶è¿Ÿäº’åŠ¨ <span class="winner">âœ“</span></p>
          <p><strong>HLS</strong>: ç§»åŠ¨ç›´æ’­ã€å¤§è§„æ¨¡åˆ†å‘ <span class="winner">âœ“</span></p>
          <p style="margin-top:10px; color:#718096; font-size:0.9em;">
            å„æœ‰ä¼˜åŠ¿ï¼Œæ ¹æ®åœºæ™¯é€‰æ‹©
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const flvVideo = document.getElementById('flv-video');
    const hlsVideo = document.getElementById('hls-video');
    
    let flvPlayer = null;
    let hlsPlayer = null;
    let flvStalls = 0;
    let hlsStalls = 0;
    
    // HTTP-FLV æ’­æ”¾
    function playFLV() {
      if (flvjs.isSupported()) {
        if (!flvPlayer) {
          flvPlayer = flvjs.createPlayer({
            type: 'flv',
            url: 'http://localhost:8080/live/stream.flv',  // 03 é¡¹ç›®çš„åœ°å€
            isLive: true,
            hasAudio: true,
            hasVideo: true
          }, {
            enableStashBuffer: false,
            stashInitialSize: 128
          });
          
          flvPlayer.attachMediaElement(flvVideo);
          flvPlayer.load();
        }
        
        flvVideo.play().then(() => {
          document.getElementById('flv-status').textContent = 'æ’­æ”¾ä¸­';
        }).catch(err => {
          console.error('FLV æ’­æ”¾å¤±è´¥:', err);
          document.getElementById('flv-status').textContent = 'é”™è¯¯';
        });
      } else {
        alert('æµè§ˆå™¨ä¸æ”¯æŒ FLV æ’­æ”¾');
      }
    }
    
    function stopFLV() {
      if (flvPlayer) {
        flvPlayer.pause();
        flvPlayer.unload();
        flvPlayer.detachMediaElement();
        flvPlayer.destroy();
        flvPlayer = null;
      }
      document.getElementById('flv-status').textContent = 'å·²åœæ­¢';
    }
    
    // HLS æ’­æ”¾
    function playHLS() {
      if (Hls.isSupported()) {
        if (!hlsPlayer) {
          hlsPlayer = new Hls({
            maxBufferLength: 10,
            maxMaxBufferLength: 30,
            liveSyncDurationCount: 1,
            liveMaxLatencyDurationCount: 3
          });
          
          hlsPlayer.loadSource('http://localhost:8080/live/stream/index.m3u8');
          hlsPlayer.attachMedia(hlsVideo);
        }
        
        hlsVideo.play().then(() => {
          document.getElementById('hls-status').textContent = 'æ’­æ”¾ä¸­';
        }).catch(err => {
          console.error('HLS æ’­æ”¾å¤±è´¥:', err);
          document.getElementById('hls-status').textContent = 'é”™è¯¯';
        });
      } else if (hlsVideo.canPlayType('application/vnd.apple.mpegurl')) {
        // Safari åŸç”Ÿæ”¯æŒ
        hlsVideo.src = 'http://localhost:8080/live/stream/index.m3u8';
        hlsVideo.play();
        document.getElementById('hls-status').textContent = 'æ’­æ”¾ä¸­';
      } else {
        alert('æµè§ˆå™¨ä¸æ”¯æŒ HLS æ’­æ”¾');
      }
    }
    
    function stopHLS() {
      if (hlsPlayer) {
        hlsPlayer.destroy();
        hlsPlayer = null;
      }
      hlsVideo.pause();
      document.getElementById('hls-status').textContent = 'å·²åœæ­¢';
    }
    
    // ç›‘å¬å¡é¡¿äº‹ä»¶
    flvVideo.addEventListener('waiting', () => {
      flvStalls++;
      document.getElementById('flv-stalls').textContent = flvStalls;
    });
    
    hlsVideo.addEventListener('waiting', () => {
      hlsStalls++;
      document.getElementById('hls-stalls').textContent = hlsStalls;
    });
    
    // å®šæ—¶æ›´æ–°ç»Ÿè®¡
    setInterval(() => {
      // FLV ç»Ÿè®¡
      if (!flvVideo.paused && flvVideo.buffered.length > 0) {
        const buffer = flvVideo.buffered.end(0) - flvVideo.currentTime;
        document.getElementById('flv-buffer').textContent = buffer.toFixed(1) + 's';
        document.getElementById('flv-latency').textContent = '~3-5s';
      }
      
      // HLS ç»Ÿè®¡
      if (!hlsVideo.paused && hlsVideo.buffered.length > 0) {
        const buffer = hlsVideo.buffered.end(0) - hlsVideo.currentTime;
        document.getElementById('hls-buffer').textContent = buffer.toFixed(1) + 's';
        // HLS å»¶è¿Ÿ â‰ˆ åˆ‡ç‰‡æ—¶é•¿ Ã— ç¼“å†²åˆ‡ç‰‡æ•°
        const estimatedLatency = 6 * 2; // 6ç§’åˆ‡ç‰‡ Ã— 2ä¸ªç¼“å†²
        document.getElementById('hls-latency').textContent = `~${estimatedLatency}s`;
      }
    }, 1000);
  </script>
</body>
</html>

