# ğŸš€ 04 HLS é¡¹ç›®å¯åŠ¨æŒ‡å—

## å¿«é€Ÿå¯åŠ¨ï¼ˆ3ä¸ªç»ˆç«¯ï¼‰

### ç»ˆç«¯ 1ï¼šå¯åŠ¨ 04 æœåŠ¡å™¨

```bash
cd 04-hls-live-streaming
npm start
```

âœ… çœ‹åˆ°å¯åŠ¨æˆåŠŸä¿¡æ¯å³å¯

---

### ç»ˆç«¯ 2ï¼šå¯åŠ¨æ¨æµå®¢æˆ·ç«¯

```bash
cd ../03-live-streaming-basic/publisher
npm start
```

æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ `http://localhost:3002`

æ“ä½œï¼š
1. é€‰æ‹©æ¨æµæºï¼ˆæ‘„åƒå¤´æˆ–æœ¬åœ°è§†é¢‘ï¼‰
2. ç‚¹å‡»"å¼€å§‹æ¨æµ"
3. ç­‰å¾…æ˜¾ç¤º"æ¨æµä¸­"

---

### ç»ˆç«¯ 3ï¼šå¯åŠ¨ HLS è½¬ç 

**æ–¹å¼Aï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰**

```bash
cd 04-hls-live-streaming
./start-hls-transcode.sh
```

**æ–¹å¼Bï¼šæ‰‹åŠ¨å‘½ä»¤**

```bash
cd 04-hls-live-streaming

# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir -p media/live/stream

# å¯åŠ¨è½¬ç 
ffmpeg -i rtmp://localhost:1935/live/stream \
  -c copy \
  -f hls \
  -hls_time 6 \
  -hls_list_size 10 \
  -hls_flags delete_segments \
  -hls_segment_filename 'media/live/stream/segment_%d.ts' \
  media/live/stream/index.m3u8
```

âœ… çœ‹åˆ° FFmpeg è¾“å‡ºä¿¡æ¯ï¼Œå¹¶å¼€å§‹ç”Ÿæˆåˆ‡ç‰‡æ–‡ä»¶

---

### æµè§ˆå™¨ï¼šè§‚çœ‹ç›´æ’­

æ‰“å¼€ï¼šhttp://localhost:3000/player.html

æ“ä½œï¼š
1. ç‚¹å‡»"â–¶ å¼€å§‹æ’­æ”¾"
2. **ç­‰å¾… 6-12 ç§’**ï¼ˆHLS éœ€è¦ç”Ÿæˆè¶³å¤Ÿçš„åˆ‡ç‰‡ï¼‰
3. å¼€å§‹æ’­æ”¾ï¼

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨è§‚çœ‹å‰ï¼Œç¡®ä¿ï¼š

- [ ] ç»ˆç«¯1ï¼šæœåŠ¡å™¨æ˜¾ç¤º"å¯åŠ¨æˆåŠŸ"
- [ ] ç»ˆç«¯2ï¼šæ¨æµå®¢æˆ·ç«¯æ˜¾ç¤º"æ¨æµä¸­"
- [ ] ç»ˆç«¯3ï¼šFFmpeg æ˜¾ç¤ºæ­£åœ¨è½¬ç ï¼ˆæœ‰å¸§æ•°è¾“å‡ºï¼‰
- [ ] `media/live/stream/` ç›®å½•ä¸‹æœ‰ `.ts` å’Œ `.m3u8` æ–‡ä»¶

æ£€æŸ¥æ–‡ä»¶ï¼š
```bash
ls -lh media/live/stream/
```

åº”è¯¥çœ‹åˆ°ï¼š
```
index.m3u8
segment_0.ts
segment_1.ts
segment_2.ts
...
```

---

## â“ å¸¸è§é—®é¢˜

### 1. æ’­æ”¾é»‘å±ï¼Ÿ

**åŸå› **ï¼šåˆ‡ç‰‡è¿˜æ²¡ç”Ÿæˆå¤Ÿ

**è§£å†³**ï¼š
1. ç­‰å¾… 6-12 ç§’
2. æ£€æŸ¥ `media/live/stream/` æ˜¯å¦æœ‰æ–‡ä»¶
3. åˆ·æ–°æ’­æ”¾å™¨é‡è¯•

---

### 2. FFmpeg æŠ¥é”™ "Connection refused"ï¼Ÿ

**åŸå› **ï¼šæ¨æµè¿˜æ²¡å¼€å§‹

**è§£å†³**ï¼š
1. å…ˆå¯åŠ¨æ¨æµå®¢æˆ·ç«¯ï¼ˆç»ˆç«¯2ï¼‰
2. ç¡®è®¤æ¨æµæˆåŠŸ
3. å†å¯åŠ¨ FFmpeg è½¬ç ï¼ˆç»ˆç«¯3ï¼‰

---

### 3. çœ‹ä¸åˆ°åˆ‡ç‰‡æ–‡ä»¶ï¼Ÿ

**æ£€æŸ¥**ï¼š
```bash
# æŸ¥çœ‹å®æ—¶ç”Ÿæˆ
watch -n 1 ls -lh media/live/stream/

# æŸ¥çœ‹ m3u8 å†…å®¹
cat media/live/stream/index.m3u8
```

å¦‚æœæ²¡æœ‰æ–‡ä»¶ï¼š
1. æ£€æŸ¥ FFmpeg æ˜¯å¦æœ‰é”™è¯¯è¾“å‡º
2. ç¡®è®¤æ¨æµåœ°å€æ­£ç¡®ï¼š`rtmp://localhost:1935/live/stream`
3. æ£€æŸ¥æƒé™ï¼š`ls -ld media/live/stream/`

---

### 4. ç«¯å£å†²çªï¼Ÿ

**1935 ç«¯å£è¢«å ç”¨**ï¼š
```bash
# æŸ¥çœ‹å ç”¨è¿›ç¨‹
lsof -i :1935

# å…³é—­è¿›ç¨‹
kill -9 <PID>
```

**3000 ç«¯å£è¢«å ç”¨**ï¼š
ä¿®æ”¹ `server/server.js` ä¸­çš„ `HTTP_PORT`

---

## ğŸ¯ å¯åŠ¨é¡ºåºæ€»ç»“

```
æ­£ç¡®é¡ºåºï¼š
1ï¸âƒ£ 04 æœåŠ¡å™¨ â†’ 2ï¸âƒ£ æ¨æµå®¢æˆ·ç«¯ â†’ 3ï¸âƒ£ HLS è½¬ç  â†’ 4ï¸âƒ£ æ’­æ”¾å™¨

é”™è¯¯é¡ºåºï¼š
âŒ å…ˆå¯åŠ¨è½¬ç ï¼ˆæ¨æµè¿˜æ²¡å¼€å§‹ï¼Œä¼šæŠ¥é”™ï¼‰
âŒ ä¸å¯åŠ¨è½¬ç ï¼ˆæ²¡æœ‰ HLS æ–‡ä»¶ï¼Œæ— æ³•æ’­æ”¾ï¼‰
```

---

## ğŸ’¡ åœæ­¢æœåŠ¡

```bash
# ç»ˆç«¯1ï¼ˆ04æœåŠ¡å™¨ï¼‰ï¼šCtrl + C
# ç»ˆç«¯2ï¼ˆæ¨æµå®¢æˆ·ç«¯ï¼‰ï¼šåœ¨ç½‘é¡µä¸Šç‚¹å‡»"åœæ­¢æ¨æµ"
# ç»ˆç«¯3ï¼ˆFFmpegè½¬ç ï¼‰ï¼šCtrl + C
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹ m3u8 å®æ—¶æ›´æ–°

```bash
watch -n 1 cat media/live/stream/index.m3u8
```

### æŸ¥çœ‹ TS æ–‡ä»¶ä¿¡æ¯

```bash
ffprobe media/live/stream/segment_0.ts
```

### æ‰‹åŠ¨æµ‹è¯•æ’­æ”¾

```bash
# ä½¿ç”¨ FFplay
ffplay http://localhost:8080/live/stream/index.m3u8

# ä½¿ç”¨ VLC
open -a VLC http://localhost:8080/live/stream/index.m3u8
```

---

ç°åœ¨ä½ å¯ä»¥å¼€å§‹ä½“éªŒ HLS ç›´æ’­äº†ï¼ğŸ‰

