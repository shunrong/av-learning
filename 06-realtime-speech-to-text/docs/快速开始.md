# 快速开始指南

## 🎯 前提条件

在开始之前，请确保你的环境满足以下要求：

### 1. 软件要求
- **Node.js**: v14.0 或更高版本
- **npm**: v6.0 或更高版本

### 2. 硬件要求
- **麦克风**: 计算机需要有可用的麦克风设备
- **音频输出**: 用于测试时的反馈

### 3. 浏览器要求
- **Chrome**: v47+ (推荐)
- **Edge**: v79+
- **Firefox**: v25+
- **Safari**: v14+ (需要启用MediaRecorder)

> ⚠️ **注意**: Safari浏览器需要在实验性功能中启用MediaRecorder API

## 📦 安装步骤

### 方式一：使用启动脚本（推荐）

```bash
# 进入项目目录
cd 06-realtime-speech-to-text

# 给启动脚本添加执行权限
chmod +x start.sh

# 运行启动脚本
./start.sh
```

启动脚本会自动：
1. 检查Node.js环境
2. 安装依赖（如果需要）
3. 启动服务器

### 方式二：手动安装

```bash
# 1. 进入项目目录
cd 06-realtime-speech-to-text

# 2. 安装依赖
npm install

# 3. 启动服务器
npm start
```

## 🚀 启动服务器

启动成功后，你将看到以下输出：

```
========================================
🎤 实时语音转文字服务器
========================================
🌐 HTTP服务: http://localhost:3000
🔌 WebSocket: ws://localhost:3000
📊 统计信息: http://localhost:3000/api/stats
========================================
💡 使用Mock ASR服务（模拟识别）
⏳ 等待客户端连接...
```

## 🌐 访问应用

1. 打开浏览器
2. 访问: http://localhost:3000
3. 你将看到实时语音转文字的主界面

## 🎤 使用流程

### 第一步：允许麦克风权限

1. 点击页面上的 **"🎙️ 开始录音"** 按钮
2. 浏览器会弹出权限请求对话框
3. 点击 **"允许"** 授予麦克风权限

<details>
<summary>如果没有弹出权限请求？</summary>

可能是之前已经拒绝过权限，需要手动重置：

**Chrome/Edge:**
1. 点击地址栏左侧的锁图标或信息图标
2. 找到"麦克风"设置
3. 选择"允许"
4. 刷新页面

**Firefox:**
1. 点击地址栏左侧的信息图标
2. 点击"更多信息"
3. 切换到"权限"标签
4. 找到"使用麦克风"，选择"允许"
5. 刷新页面
</details>

### 第二步：开始录音

1. 授权成功后，录音会自动开始
2. 页面顶部连接状态会显示 **"已连接"** (绿色)
3. 状态栏显示 **"正在录音..."** (绿色)
4. 音量条会实时显示你的麦克风音量

### 第三步：查看识别结果

1. 对着麦克风说话
2. 识别结果会实时显示在 **"📝 转写结果"** 区域
3. **灰色背景** = 临时结果
4. **蓝色背景** = 最终结果

每条结果包含：
- ⏰ 时间戳
- 📝 识别的文字
- 🎯 结果类型（临时/最终）
- 📊 置信度

### 第四步：控制录音

**暂停/继续**:
- 点击 **"⏸️ 暂停"** 按钮暂停录音
- 再次点击（现在显示 **"▶️ 继续"**）恢复录音

**停止录音**:
- 点击 **"⏹️ 停止录音"** 按钮
- 录音结束，可以点击"开始录音"重新开始

### 第五步：管理结果

**清空结果**:
- 点击 **"🗑️ 清空"** 按钮
- 确认后删除所有转写内容

**导出文本**:
- 点击 **"💾 导出"** 按钮
- 系统会下载一个TXT文件
- 文件包含所有识别结果和统计信息

## 📊 测试建议

### 1. 测试音量

说话之前，先观察音量条：
- **绿色 (0-30%)**: 音量偏低
- **橙色 (30-70%)**: 音量适中（推荐）
- **红色 (70-100%)**: 音量过高

### 2. 测试识别

由于使用Mock ASR服务，系统会返回随机文本。你可以：
- 观察实时性（延迟200-500ms）
- 查看临时结果和最终结果的区别
- 测试暂停/继续功能
- 测试导出功能

### 3. 观察服务器日志

在终端中，你可以看到：
```
🔌 新客户端连接: 1696789012345-abc123
📨 控制消息 [1696789012345-abc123]: start
🎤 [1696789012345-abc123] 已接收 10 个音频片段
🎤 [1696789012345-abc123] 已接收 20 个音频片段
```

## 🔍 查看统计信息

访问 http://localhost:3000/api/stats 可以看到：

```json
{
  "success": true,
  "data": {
    "activeClients": 1,
    "asrStats": {
      "totalRequests": 45,
      "totalAudioChunks": 45,
      "runningTime": "120秒",
      "avgRequestsPerSecond": "0.38"
    },
    "clients": [
      {
        "id": "1696789012345-abc123",
        "connectedAt": "2024-10-08T06:30:12.345Z",
        "audioChunks": 45
      }
    ]
  }
}
```

## ❓ 常见问题

### Q1: 服务器启动失败？

**可能原因**:
- 端口3000已被占用

**解决方案**:
```bash
# 查看占用端口的进程
lsof -i :3000

# 杀死进程
kill -9 <PID>

# 或者修改端口
# 编辑 server/server.js，将 PORT 改为其他值（如3001）
```

### Q2: 页面无法访问？

**检查项**:
1. 服务器是否正常运行？
2. 终端是否显示启动成功消息？
3. 尝试访问 http://127.0.0.1:3000

### Q3: 麦克风权限被拒绝？

**解决方案**:
1. 检查浏览器权限设置
2. 检查系统隐私设置（Mac系统偏好设置 -> 安全性与隐私 -> 麦克风）
3. 确保其他应用没有独占麦克风

### Q4: 没有识别结果？

**检查项**:
1. WebSocket连接状态是否为"已连接"？
2. 浏览器控制台是否有错误？
3. 音量条是否有变化？

**调试方法**:
```javascript
// 打开浏览器控制台（F12），查看日志
// 应该能看到类似的输出：
✅ WebSocket连接成功
📡 服务器消息: 连接成功！开始录音后会实时返回识别结果
✅ 录音器初始化成功
🎤 开始录音
```

### Q5: 为什么识别结果是随机文本？

这是正常的！本项目使用 **Mock ASR服务** 进行演示和学习。

Mock服务会：
- ✅ 模拟真实的识别延迟（200-500ms）
- ✅ 返回预设的随机文本
- ✅ 模拟临时结果和最终结果
- ✅ 生成置信度数据

**接入真实AI服务**:
- 参考文档: `docs/接入真实ASR指南.md`
- 支持阿里云、讯飞、腾讯云等平台

## 🎯 下一步

### 1. 学习架构
- 阅读: `docs/技术架构详解.md`
- 了解前后端如何协同工作
- 掌握WebSocket通信机制

### 2. 查看代码
- **客户端录音**: `client/AudioRecorder.js`
- **应用逻辑**: `client/app.js`
- **WebSocket服务器**: `server/server.js`
- **Mock ASR**: `server/MockASRService.js`

### 3. 接入真实AI
- 阅读: `docs/接入真实ASR指南.md`
- 选择ASR服务商（阿里云/讯飞/腾讯云）
- 替换Mock服务

### 4. 功能扩展
- 添加录音回放功能
- 实现历史记录存储
- 支持多人会议转写
- 添加说话人识别

## 💡 开发建议

### 启用开发模式

```bash
# 使用nodemon自动重启
npm run dev
```

修改代码后，服务器会自动重启。

### 查看详细日志

服务器会输出详细的日志信息：
- 🔌 客户端连接/断开
- 📨 控制消息
- 🎤 音频片段统计
- ❌ 错误信息

### 调试技巧

1. **浏览器控制台**: 查看前端日志和错误
2. **终端输出**: 查看服务器日志
3. **Network面板**: 查看WebSocket消息
4. **统计接口**: 实时查看运行状态

## 📚 相关文档

- [项目README](../README.md) - 项目介绍和总体说明
- [技术架构详解](技术架构详解.md) - 深入了解技术实现
- [接入真实ASR指南](接入真实ASR指南.md) - 接入真实AI服务

## 🎉 开始使用

一切就绪！现在你可以：

1. ✅ 启动服务器
2. ✅ 打开浏览器
3. ✅ 开始录音
4. ✅ 查看识别结果
5. ✅ 学习架构和代码

祝你学习愉快！🚀

